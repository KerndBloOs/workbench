# ~/.bashrc
#

###### bash-config #######

# load bash_alias if present
if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

# set editing mode
set -o vi



###### path configuration ###### 

# add path directories and avoid duplicates
add_to_path() {
  case ":$PATH:" in
    *":$1:"*) ;; # already there
    *) export PATH="$1:$PATH" ;;
  esac
}
add_to_path "$HOME/bin:$HOME/.local/bin:/home/vscode/.local/bin:/root/.local/bin"

shopt -s extglob    # Enables extended globbing
shopt -s nullglob   # Makes unmatched globs expand to nothing


# for dev container
if [ -d "/home/linuxbrew/.linuxbrew" ]; then
     eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
fi

# history
export HISTFILE=$HOME/.histfile
export HISTSIZE=50000
export SAVEHIST=50000
export HISTCONTROL=ignorespace

# directories
export GR="$HOME/git-repos"
export GITUSER="kerndbloos"
export DOTFILES="$HOME/.local/share/chezmoi"



###### tools ######

# neovim
if command -v nvim > /dev/null ; then
  export EDITOR="nvim"
  export VISUAL="nvim"
fi

# starship
if command -v starship > /dev/null ; then
  eval "$(starship init bash)"
fi

# fzf
if command -v fzf > /dev/null ; then
  eval "$(fzf --bash)" 
fi

# mise
if command -v mise > /dev/null ; then
  eval "$($HOME/.local/bin/mise activate bash)"
fi

# ssh agent
if [ -z "$SSH_AUTH_SOCK" ] ; then
    eval $(ssh-agent -s)
    ssh-add
fi




###### aliases ######

alias t='/usr/bin/tmux attach || /usr/bin/tmux'
alias c='clear'
alias v='nvim'
alias e='exit'
alias ..="cd .."
alias ll='ls -lgha --color=auto'
alias la='ls -lathr'
alias ds='devpod ssh'
alias key='eval $(ssh-agent -s); ssh-add'
alias his='cat $HOME/.histfile | fzf

# weather
w () { # weather for specific location
  curl "https://wttr.in/$1?1&F&q"
}

wv () { # weather forecast for specific location
  curl "https://wttr.in/$2?format=1"
}

#setvar() {
#    if [ -z "$loc" ]; then
#        echo "insert location"
#        return 1
#    fi
#    export "location=$loc"
#}
#alias wv='curl "https://wttr.in/$loc?1&F&q"'
#alias w='curl "https://wttr.in/$loc?format=1"'

if command -v bat > /dev/null ; then
  alias cat="bat"
fi

# git
alias gp='git pull'
alias gs='git status'
alias gc='git commit -m'
alias lg='lazygit'

# directories
alias gd='cd $HOME/git-repos/dotfiles; ls -la --color=auto'
alias gr='cd $HOME/git-repos/'

# credits to mischavandenburg
# use fp to do a fzf search and preview the files
alias fp="fzf --preview 'bat --style=numbers --color=always --line-range :500 {}'"
# search for a file with fzf and open it in vim
alias vf='vim $(fp)'
